<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kcc.banking.domain.trade.mapper.TradeMapper">

    <resultMap id="TradeOfListMap" type="TradeOfList">
        <result property="tradeDate" column="trade_date" />
        <result property="accId" column="acc_id" />
        <result property="targetAccId" column="target_acc_id" />
        <result property="tradeType" column="trade_type" />
        <result property="cashIndicator" column="cash_indicator" />
        <result property="amount" column="amount" />
        <result property="balance" column="balance" />
        <result property="status" column="status"/>
    </resultMap>

    <select id="findTradeListOfAccId" parameterType="TradeSearch"  resultMap="TradeOfListMap">

        SELECT
            trade_date,
            acc_id,
            target_acc_id,
            trade_type,
            cash_indicator,
            amount,
            balance,
            status
        FROM
        Trade
        <where>
            <!-- 계좌번호 조회 -->
            <if test="accId != null and !accId.equals('')">
                acc_id LIKE #{accId} || '%'
            </if>

            <!-- 거래유형 조회 -->
            <if test="tradeType != null and !tradeType.equals('')">
                and trade_type LIKE #{tradeType}
            </if>

            <!-- 날짜 직접 입력 검색 -->
            <if test="startDate != null and endDate != null">
                and trade_date BETWEEN #{startDate} AND #{endDate}
            </if>


        </where>

        <!-- 정렬 기준 -->
        <choose>
            <when test="sortOrder == 'latest'">
                ORDER BY trade_date DESC
            </when>
            <when test="sortOrder == 'oldest'">
                ORDER BY trade_date ASC
            </when>
        </choose>

    </select>

    <select id="findTradeByCashList" parameterType="BusinessDateAndEmployeeId">

        select trade_date, acc_id, trade_type, amount, e.name as "registrant_name", b.name as "branch_name" from trade t
        join employee e on t.registrant_id = e.id
        join branch b on t.branch_id = b.id
        where cash_indicator = 'TRUE' and t.registrant_id = #{employeeId} and trade_date = #{businessDate}

    </select>

</mapper>
